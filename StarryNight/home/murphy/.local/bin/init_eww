#!/bin/bash

# this script will set the initial values of some variables in eww

GetCurrentInterface() {
	if [[ $( nmcli connection | grep -o "enp6s0"  ) == "enp6s0" ]]; then
		echo "M-Murphy 1"
	elif [[ $( nmcli connection | grep -o "enp0s20f0u1" ) == "enp0s20f0u1" ]]; then
		echo "P-Murphy 2"
	elif [[ $( nmcli connection | grep -o "wlp0s20f0u10"  ) == "wlp0s20f0u10" ]]; then
		echo "I-Murphy 3"
	elif [[ $( nmcli connection | grep -o "enp0s20f0u6u1"  ) == "enp0s20f0u6u1" ]]; then
		echo "S-Murphy 4"
	fi
}

# Network
current_interface=$( GetCurrentInterface )
eww update cycle_btn_class="cycle_btn_class${current_interface:9:9}"
eww update cycle_btn_status_class="cycle_btn_status_class${current_interface:9:9}"
eww update cycle_btn_status="${current_interface:0:8}" 

# Vpn
eww update vpn_status=$( nmcli device show l-hetzner1-1 | grep -o connected )

# Workspaces
for number in {1..6} ; do (

	# Get the occupied and active workspaces
	occupied_workspaces=$(bspc query -D -d .occupied --names)
	active_workspaces=$(bspc query -D -d .active --names)

	# Update the workspace icons
	if echo $active_workspaces | grep -q "$number" ; then
		eww update workspace"$number"_icon=
	else
		eww update workspace"$number"_icon=
	fi

	# Update the workspace colors
	if echo $occupied_workspaces | grep -q "$number" ; then
		eww update workspace"$number"_class=workspace_occupied
	elif echo $active_workspaces | grep -q "$number" ; then
		eww update workspace"$number"_class=workspace_occupied
	else
		eww update workspace"$number"_class=workspace_unoccupied
	fi

) &
done
